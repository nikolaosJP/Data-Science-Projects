<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Machine Learning & XAI Platform</title>
<link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
</head>
<body>
<!-- Your existing HTML content stays the same -->
<div class="container">
  <div class="header">
    <h1>Machine Learning & XAI Platform</h1>
    <div class="hint">Click to add • Drag to move • Right-click to delete</div>
  </div>

  <div class="tabs">
    <div class="tab active" data-tab="linear">Linear Models</div>
    <div class="tab" data-tab="nonlinear">Nonlinear Models</div>
    <div class="tab" data-tab="stats">Statistics</div>
    <div class="tab" data-tab="recsys">Recommendation Systems</div>
    <div class="tab" data-tab="clustering">Clustering</div>
  </div>

  <div class="panel" id="general-controls-panel">
    <div class="controls">
      <button id="clear">Clear</button>
      <button id="sample">Sample</button>
      <label><input id="residuals" type="checkbox" checked> Residuals</label>
      <span><strong>Points: </strong><span id="point-count">0</span></span>
    </div>
  </div>

  <!-- Linear Models Tab -->
  <div class="tab-content active" id="tab-linear">
    <div class="panel">
      <div class="tabs" style="margin-bottom: 16px;">
        <div class="tab active" data-regtab="ols">OLS</div>
        <div class="tab" data-regtab="gd">Gradient Descent</div>
        <div class="tab" data-regtab="manual">Manual Stats</div>
        <div class="tab" data-regtab="logistic">Logistic Regression</div>
      </div>

      <!-- OLS Subtab -->
      <div class="regtab-content active" id="regtab-ols">
    <div class="main-grid">
      <div class="panel">
        <canvas id="plot-ols" width="800" height="500"></canvas>
      </div>
      <div>
        <div class="panel">
          <h3>OLS</h3>
          <button id="solve-ols" class="primary">Solve</button>
          <div class="formula" id="ols-formula"></div>
          <div class="values-grid">
            <div class="value-box"><strong>m</strong><div id="ols-m">—</div></div>
            <div class="value-box"><strong>b</strong><div id="ols-b">—</div></div>
            <div class="value-box"><strong>R²</strong><div id="ols-r2">—</div></div>
            <div class="value-box"><strong>MSE</strong><div id="ols-mse">—</div></div>
          </div>
          <div id="ols-calculations" style="display:none">
            <h4>Steps</h4>
            <div class="calculations" id="ols-steps"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

      <!-- GD Subtab -->
      <div class="regtab-content" id="regtab-gd">
    <div class="main-grid">
      <div class="panel">
        <div class="gd-grid">
          <div>
            <div class="subtle">Data + Fit</div>
            <canvas id="plot-gd" width="800" height="500"></canvas>
          </div>
          <div>
            <div class="subtle">Loss History</div>
            <canvas id="loss-plot" width="380" height="500"></canvas>
          </div>
        </div>
      </div>
      <div>
        <div class="panel">
          <h3>Gradient Descent</h3>
          <div class="controls">
            <button id="init-gd" class="warning">Initialize</button>
            <button id="next-step" class="success" disabled>Next</button>
            <button id="auto-run">Auto</button>
            <button id="reset-gd">Reset</button>
          </div>
          <label>η: <input id="lr" type="number" step="0.01" value="0.1" min="0.001"></label>
          <div class="iteration-info">
            <strong>Iter: </strong><span id="iteration">0</span> •
            <strong>Step: </strong><span id="current-step-name">Not Started</span>
          </div>

          <!-- GD Steps -->
          <div class="step-info" id="step-0" style="display:none">
            <div class="step-title">Step 0: Init</div>
            <div class="formula" id="gd-init-formula"></div>
          </div>
          <div class="step-info" id="step-1" style="display:none">
            <div class="step-title">Step 1: Predictions</div>
            <div class="formula" id="gd-h-formula"></div>
            <div class="table-container">
              <table id="pred-table">
                <thead><tr><th>i</th><th>xᵢ</th><th>yᵢ</th><th>hᵢ</th><th>Error</th></tr></thead>
                <tbody id="pred-body"></tbody>
              </table>
            </div>
          </div>
          <div class="step-info" id="step-2" style="display:none">
            <div class="step-title">Step 2: Cost</div>
            <div class="formula" id="gd-j-formula"></div>
            <div class="value-box"><strong>J</strong><div id="cost-value">—</div></div>
          </div>
          <div class="step-info" id="step-3" style="display:none">
            <div class="step-title">Step 3: Gradients</div>
            <div class="formula" id="gd-grads-formula"></div>
            <div class="values-grid">
              <div class="value-box"><strong>∂J/∂m</strong><div id="grad-m-val">—</div></div>
              <div class="value-box"><strong>∂J/∂b</strong><div id="grad-b-val">—</div></div>
            </div>
          </div>
          <div class="step-info" id="step-4" style="display:none">
            <div class="step-title">Step 4: Update</div>
            <div class="formula" id="gd-update-formula"></div>
            <div class="values-grid">
              <div class="value-box"><strong>New m</strong><div id="new-m-val">—</div></div>
              <div class="value-box"><strong>New b</strong><div id="new-b-val">—</div></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

      <!-- Manual Subtab -->
      <div class="regtab-content" id="regtab-manual">
    <div class="main-grid">
      <div class="panel">
        <canvas id="plot-manual" width="800" height="500"></canvas>
      </div>
      <div>
        <div class="panel">
          <h3>Manual Stats</h3>
          <button id="calculate-manual" class="primary">Calculate</button>
          <div id="manual-calculations" style="display:none">
            <h4>Means</h4>
            <div class="calculations">
              <div class="calc-step"><span id="mean-x-tex"></span></div>
              <div class="calc-step"><span id="mean-y-tex"></span></div>
            </div>
            <h4>Sums of Squares</h4>
            <div class="calculations">
              <div class="calc-step"><span id="ssxx-tex"></span></div>
              <div class="calc-step"><span id="ssyy-tex"></span></div>
              <div class="calc-step"><span id="ssxy-tex"></span></div>
            </div>
            <h4>Coefficients</h4>
            <div class="calculations">
              <div class="calc-step"><span id="b1-tex"></span></div>
              <div class="calc-step"><span id="b0-tex"></span></div>
            </div>
            <h4>Errors</h4>
            <div class="calculations">
              <div class="calc-step"><span id="tss-tex"></span></div>
              <div class="calc-step"><span id="ess-tex"></span></div>
              <div class="calc-step"><span id="rss-tex"></span></div>
            </div>
            <h4>Fit</h4>
            <div class="calculations">
              <div class="calc-step"><span id="r2-tex"></span></div>
              <div class="calc-step"><span id="mse-tex"></span></div>
              <div class="calc-step"><span id="rmse-tex"></span></div>
            </div>
            <div class="values-grid">
              <div class="value-box"><strong>Final b₁</strong><div id="final-b1">—</div></div>
              <div class="value-box"><strong>Final b₀</strong><div id="final-b0">—</div></div>
            </div>
          </div>
        </div>
        <div class="panel">
          <h3>Data Table</h3>
          <div class="table-container">
            <table id="manual-table">
              <thead>
                <tr><th>i</th><th>xᵢ</th><th>yᵢ</th><th>x-x̄</th><th>y-ȳ</th><th>(x-x̄)²</th><th>(y-ȳ)²</th><th>(x-x̄)(y-ȳ)</th></tr>
              </thead>
              <tbody id="manual-body"></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>

      <!-- Logistic Regression Subtab -->
      <div class="regtab-content" id="regtab-logistic">
    <div class="main-grid">
      <div class="panel">
        <div class="gd-grid">
          <div>
            <div class="subtle">Classification Data + Decision Boundary</div>
            <canvas id="plot-logistic" width="800" height="500"></canvas>
            <div class="hint" style="margin-top: 10px;">Select a group button, then click to add points. Red = Group 0, Blue = Group 1.</div>
          </div>
          <div>
            <div class="subtle">Loss History</div>
            <canvas id="lr-loss-plot" width="380" height="500"></canvas>
          </div>
        </div>
      </div>
      <div>
        <div class="panel">
          <h3>Logistic Regression</h3>
          <div class="controls">
            <button id="init-lr" class="warning">Initialize</button>
            <button id="next-step-lr" class="success" disabled>Next</button>
            <button id="lr-auto-run">Auto</button>
            <button id="reset-lr">Reset</button>
          </div>
          <div class="controls">
            <strong>Select Group:</strong>
            <button id="lr-group0-btn" class="warning">Group 0</button>
            <button id="lr-group1-btn">Group 1</button>
          </div>
          <label>η: <input id="lr-lr" type="number" step="0.01" value="0.1" min="0.001"></label>
          <div class="iteration-info">
            <strong>Iter: </strong><span id="lr-iteration">0</span> •
            <strong>Step: </strong><span id="lr-current-step-name">Not Started</span>
          </div>

          <h4>Classification Metrics</h4>
          <label>
            Threshold: <input id="lr-threshold" type="range" min="0" max="1" step="0.01" value="0.5">
            <span id="lr-threshold-val">0.50</span>
            <button id="lr-youden-btn" class="success" style="margin-left: 8px;">Use Youden</button>
          </label>

          <div class="confusion-matrix" id="lr-confusion-matrix" style="display:none">
            <h4>Confusion Matrix</h4>
            <table class="cm-table">
              <thead>
                <tr>
                  <th></th>
                  <th>Predicted 0</th>
                  <th>Predicted 1</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <th>Actual 0</th>
                  <td id="cm-tn">0</td>
                  <td id="cm-fp">0</td>
                </tr>
                <tr>
                  <th>Actual 1</th>
                  <td id="cm-fn">0</td>
                  <td id="cm-tp">0</td>
                </tr>
              </tbody>
            </table>
          </div>

          <div class="values-grid">
            <div class="value-box"><strong>Accuracy</strong><div id="lr-accuracy">—</div></div>
            <div class="value-box"><strong>Precision</strong><div id="lr-precision">—</div></div>
            <div class="value-box"><strong>Recall</strong><div id="lr-recall">—</div></div>
            <div class="value-box"><strong>Specificity</strong><div id="lr-specificity">—</div></div>
            <div class="value-box"><strong>F1 Score</strong><div id="lr-f1">—</div></div>
            <div class="value-box"><strong>Youden</strong><div id="lr-youden">—</div></div>
          </div>

          <!-- LR Steps -->
          <div class="step-info" id="lr-step-0" style="display:none">
            <div class="step-title">Step 0: Init</div>
            <div class="formula" id="lr-init-formula"></div>
          </div>
          <div class="step-info" id="lr-step-1" style="display:none">
            <div class="step-title">Step 1: Predictions</div>
            <div class="formula" id="lr-h-formula"></div>
            <div class="table-container">
              <table id="lr-pred-table">
                <thead><tr><th>i</th><th>xᵢ</th><th>yᵢ</th><th>hᵢ</th><th>Error</th></tr></thead>
                <tbody id="lr-pred-body"></tbody>
              </table>
            </div>
          </div>
          <div class="step-info" id="lr-step-2" style="display:none">
            <div class="step-title">Step 2: Cost</div>
            <div class="formula" id="lr-j-formula"></div>
            <div class="value-box"><strong>J</strong><div id="lr-cost-value">—</div></div>
          </div>
          <div class="step-info" id="lr-step-3" style="display:none">
            <div class="step-title">Step 3: Gradients</div>
            <div class="formula" id="lr-grads-formula"></div>
            <div class="values-grid">
              <div class="value-box"><strong>∂J/∂m</strong><div id="lr-grad-m-val">—</div></div>
              <div class="value-box"><strong>∂J/∂b</strong><div id="lr-grad-b-val">—</div></div>
            </div>
          </div>
          <div class="step-info" id="lr-step-4" style="display:none">
            <div class="step-title">Step 4: Update</div>
            <div class="formula" id="lr-update-formula"></div>
            <div class="values-grid">
              <div class="value-box"><strong>New m</strong><div id="lr-new-m-val">—</div></div>
              <div class="value-box"><strong>New b</strong><div id="lr-new-b-val">—</div></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
    </div>
  </div>

  <!-- Nonlinear Models Tab -->
  <div class="tab-content" id="tab-nonlinear">
    <div class="panel">
      <div class="tabs" style="margin-bottom: 16px;">
        <div class="tab active" data-nltab="dt">Decision Tree</div>
        <div class="tab" data-nltab="rf">Random Forest</div>
        <div class="tab" data-nltab="xgb">XGBoost</div>
        <div class="tab" data-nltab="nn">Neural Network</div>
      </div>

      <!-- Decision Tree Subtab -->
      <div class="nltab-content active" id="nltab-dt">
        <div class="main-grid">
          <div class="panel">
            <canvas id="plot-dt" width="800" height="500"></canvas>
            <div class="hint">Select task type • Select class for classification • Click to add points • Right-click to delete</div>
          </div>
          <div>
            <div class="panel">
              <h3>Decision Tree</h3>
              <div class="controls">
                <span><strong>Task: </strong></span>
                <button id="dt-task-reg" class="success">Regression</button>
                <button id="dt-task-cls">Classification</button>
              </div>
              <div class="controls" id="dt-class-selector" style="display:none;">
                <span><strong>Class: </strong></span>
                <button id="dt-class0-btn" class="warning">Class 0</button>
                <button id="dt-class1-btn">Class 1</button>
              </div>
              <label>Max Depth: <input id="dt-max-depth" type="number" min="1" max="10" value="3"></label>
              <label>Min Samples Split: <input id="dt-min-samples" type="number" min="2" max="20" value="2"></label>
              <div class="controls">
                <button id="fit-dt" class="primary">Build Tree Step-by-Step</button>
                <button id="reset-dt">Reset</button>
              </div>

              <div id="dt-steps" style="display:none">
                <h4>Building Decision Tree</h4>
                <div class="step-info">
                  <div class="step-title">Build Process</div>
                  <div id="dt-step-display" class="calculations"></div>
                </div>
              </div>

              <div id="dt-metrics" style="display:none">
                <h4>Model Metrics</h4>
                <div class="values-grid" id="dt-reg-metrics">
                  <div class="value-box"><strong>MSE</strong><div id="dt-mse">—</div></div>
                  <div class="value-box"><strong>R²</strong><div id="dt-r2">—</div></div>
                  <div class="value-box"><strong>MAE</strong><div id="dt-mae">—</div></div>
                </div>
                <div class="values-grid" id="dt-cls-metrics" style="display:none">
                  <div class="value-box"><strong>Accuracy</strong><div id="dt-accuracy">—</div></div>
                  <div class="value-box"><strong>Precision</strong><div id="dt-precision">—</div></div>
                  <div class="value-box"><strong>Recall</strong><div id="dt-recall">—</div></div>
                  <div class="value-box"><strong>F1 Score</strong><div id="dt-f1">—</div></div>
                </div>
              </div>

              <div id="dt-tree-viz" style="display:none">
                <h4>Tree Structure</h4>
                <div class="calculations" style="background:#f8fafc;padding:12px;border-radius:4px;max-height:400px;overflow-y:auto;">
                  <div id="dt-tree-display"></div>
                </div>
              </div>

              <div class="calculations" style="background:#e0f2fe;padding:8px;border-radius:4px;margin-top:12px;">
                <p style="margin:4px 0;font-size:12px;"><strong>Decision Tree:</strong> Recursively partitions the feature space using threshold splits. At each node, finds the best split that minimizes impurity (Gini for classification, MSE for regression). <strong>Criterion:</strong> Gini Impurity = 1 - Σ(pᵢ²) or MSE = (1/n)Σ(yᵢ - ŷ)²</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Random Forest Subtab -->
      <div class="nltab-content" id="nltab-rf">
        <div class="main-grid">
          <div class="panel">
            <canvas id="plot-rf" width="800" height="500"></canvas>
            <div class="hint">Select task type • Select class for classification • Click to add points • Right-click to delete</div>
          </div>
          <div>
            <div class="panel">
              <h3>Random Forest</h3>
              <div class="controls">
                <span><strong>Task: </strong></span>
                <button id="rf-task-reg" class="success">Regression</button>
                <button id="rf-task-cls">Classification</button>
              </div>
              <div class="controls" id="rf-class-selector" style="display:none;">
                <span><strong>Class: </strong></span>
                <button id="rf-class0-btn" class="warning">Class 0</button>
                <button id="rf-class1-btn">Class 1</button>
              </div>
              <label>Number of Trees: <input id="rf-n-trees" type="number" min="1" max="100" value="10"></label>
              <label>Max Depth: <input id="rf-max-depth" type="number" min="1" max="10" value="3"></label>
              <label>Min Samples Split: <input id="rf-min-samples" type="number" min="2" max="20" value="2"></label>
              <label>Max Features: <input id="rf-max-features" type="number" min="1" max="10" value="1"></label>
              <div class="controls">
                <button id="fit-rf" class="primary">Build Forest</button>
                <button id="reset-rf">Reset</button>
              </div>

              <div id="rf-steps" style="display:none">
                <h4>Building Random Forest</h4>
                <div class="step-info">
                  <div class="step-title">Build Process</div>
                  <div id="rf-step-display" class="calculations"></div>
                </div>
              </div>

              <div id="rf-metrics" style="display:none">
                <h4>Model Metrics</h4>
                <div class="values-grid" id="rf-reg-metrics">
                  <div class="value-box"><strong>MSE</strong><div id="rf-mse">—</div></div>
                  <div class="value-box"><strong>R²</strong><div id="rf-r2">—</div></div>
                  <div class="value-box"><strong>MAE</strong><div id="rf-mae">—</div></div>
                  <div class="value-box"><strong>OOB Error</strong><div id="rf-oob">—</div></div>
                </div>
                <div class="values-grid" id="rf-cls-metrics" style="display:none">
                  <div class="value-box"><strong>Accuracy</strong><div id="rf-accuracy">—</div></div>
                  <div class="value-box"><strong>Precision</strong><div id="rf-precision">—</div></div>
                  <div class="value-box"><strong>Recall</strong><div id="rf-recall">—</div></div>
                  <div class="value-box"><strong>F1 Score</strong><div id="rf-f1">—</div></div>
                  <div class="value-box"><strong>OOB Score</strong><div id="rf-oob-cls">—</div></div>
                </div>
              </div>

              <div id="rf-trees-viz" style="display:none">
                <h4>Forest Summary (Trees: <span id="rf-tree-count">0</span>)</h4>
                <div class="calculations" style="background:#f8fafc;padding:12px;border-radius:4px;max-height:300px;overflow-y:auto;">
                  <div id="rf-trees-display"></div>
                </div>
              </div>

              <div class="calculations" style="background:#e0f2fe;padding:8px;border-radius:4px;margin-top:12px;">
                <p style="margin:4px 0;font-size:12px;"><strong>Random Forest:</strong> Ensemble of decision trees trained on bootstrap samples with random feature subsets. Predictions are averaged (regression) or majority voted (classification). <strong>Bootstrap:</strong> Sample with replacement. <strong>Out-of-Bag (OOB):</strong> Validation using samples not in bootstrap.</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- XGBoost Subtab -->
      <div class="nltab-content" id="nltab-xgb">
        <div class="main-grid">
          <div class="panel">
            <div class="gd-grid">
              <div>
                <div class="subtle">Data + Predictions</div>
                <canvas id="plot-xgb" width="800" height="500"></canvas>
                <div class="hint">Select task type • Select class for classification • Click to add points • Right-click to delete</div>
              </div>
              <div>
                <div class="subtle">Loss History</div>
                <canvas id="xgb-loss-plot" width="380" height="500"></canvas>
              </div>
            </div>
          </div>
          <div>
            <div class="panel">
              <h3>XGBoost</h3>
              <div class="controls">
                <span><strong>Task: </strong></span>
                <button id="xgb-task-reg" class="success">Regression</button>
                <button id="xgb-task-cls">Classification</button>
              </div>
              <div class="controls" id="xgb-class-selector" style="display:none;">
                <span><strong>Class: </strong></span>
                <button id="xgb-class0-btn" class="warning">Class 0</button>
                <button id="xgb-class1-btn">Class 1</button>
              </div>
              <div class="controls">
                <button id="init-xgb" class="warning">Initialize</button>
                <button id="next-boost-xgb" class="success" disabled>Next Boost</button>
                <button id="auto-xgb">Auto</button>
                <button id="reset-xgb">Reset</button>
              </div>
              <label>Learning Rate (η): <input id="xgb-lr" type="number" step="0.05" value="0.3" min="0.01" max="1"></label>
              <label>Max Depth: <input id="xgb-max-depth" type="number" min="1" max="8" value="3"></label>
              <label>Lambda (L2): <input id="xgb-lambda" type="number" step="0.1" value="1" min="0"></label>
              <label>Min Split Loss (γ): <input id="xgb-gamma" type="number" step="0.1" value="0" min="0"></label>
              <label>Subsample: <input id="xgb-subsample" type="number" step="0.1" value="1.0" min="0.1" max="1"></label>

              <div class="iteration-info">
                <strong>Iteration: </strong><span id="xgb-iteration">0</span> •
                <strong>Trees: </strong><span id="xgb-tree-count">0</span>
              </div>

              <div id="xgb-steps" style="display:none">
                <h4>Current Boosting Round</h4>
                <div class="step-info">
                  <div class="step-title">Iteration Details</div>
                  <div id="xgb-step-display" class="calculations"></div>
                </div>
              </div>

              <div id="xgb-metrics" style="display:none">
                <h4>Model Metrics</h4>
                <div class="values-grid" id="xgb-reg-metrics">
                  <div class="value-box"><strong>MSE</strong><div id="xgb-mse">—</div></div>
                  <div class="value-box"><strong>R²</strong><div id="xgb-r2">—</div></div>
                  <div class="value-box"><strong>MAE</strong><div id="xgb-mae">—</div></div>
                  <div class="value-box"><strong>RMSE</strong><div id="xgb-rmse">—</div></div>
                </div>
                <div class="values-grid" id="xgb-cls-metrics" style="display:none">
                  <div class="value-box"><strong>Accuracy</strong><div id="xgb-accuracy">—</div></div>
                  <div class="value-box"><strong>Precision</strong><div id="xgb-precision">—</div></div>
                  <div class="value-box"><strong>Recall</strong><div id="xgb-recall">—</div></div>
                  <div class="value-box"><strong>F1 Score</strong><div id="xgb-f1">—</div></div>
                  <div class="value-box"><strong>Log Loss</strong><div id="xgb-logloss">—</div></div>
                </div>
              </div>

              <div id="xgb-tree-viz" style="display:none">
                <h4>Current Tree (Iteration <span id="xgb-current-tree-iter">0</span>)</h4>
                <div class="calculations" style="background:#f8fafc;padding:12px;border-radius:4px;max-height:300px;overflow-y:auto;">
                  <div id="xgb-tree-display"></div>
                </div>
              </div>

              <div class="calculations" style="background:#e0f2fe;padding:8px;border-radius:4px;margin-top:12px;">
                <p style="margin:4px 0;font-size:12px;"><strong>XGBoost:</strong> Gradient boosting that sequentially builds trees to correct residuals. Each tree is trained on gradients of the loss function. <strong>Update:</strong> F(x) ← F(x) + η·tree(x). <strong>Regularization:</strong> L2 penalty (λ) on leaf weights. <strong>Loss:</strong> MSE for regression, Log Loss for classification.</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Neural Network Subtab -->
      <div class="nltab-content" id="nltab-nn">
        <div class="main-grid">
          <div class="panel">
            <div class="gd-grid">
              <div>
                <div class="subtle">Data + Predictions</div>
                <canvas id="plot-nn" width="800" height="500"></canvas>
                <div class="hint">Select task type • Select class for classification • Click to add points • Right-click to delete</div>
              </div>
              <div>
                <div class="subtle">Loss History</div>
                <canvas id="nn-loss-plot" width="380" height="500"></canvas>
              </div>
            </div>
          </div>
          <div>
            <div class="panel">
              <h3>Feedforward Neural Network</h3>
              <div class="controls">
                <span><strong>Task: </strong></span>
                <button id="nn-task-reg" class="success">Regression</button>
                <button id="nn-task-cls">Classification</button>
              </div>
              <div class="controls" id="nn-class-selector" style="display:none;">
                <span><strong>Class: </strong></span>
                <button id="nn-class0-btn" class="warning">Class 0</button>
                <button id="nn-class1-btn">Class 1</button>
              </div>
              <div class="controls">
                <button id="init-nn" class="warning">Initialize</button>
                <button id="next-epoch-nn" class="success" disabled>Next Epoch</button>
                <button id="auto-nn">Auto</button>
                <button id="reset-nn">Reset</button>
              </div>
              <label>Hidden Layer Sizes: <input id="nn-hidden" type="text" value="4,3" placeholder="e.g., 4,3"></label>
              <label>Learning Rate (η): <input id="nn-lr" type="number" step="0.01" value="0.1" min="0.001" max="1"></label>
              <label>Max Epochs (Auto): <input id="nn-max-epochs" type="number" min="1" max="1000" value="100"></label>
              <label>L2 Regularization (λ): <input id="nn-lambda" type="number" step="0.001" value="0.001" min="0" max="1"></label>
              <label>Dropout Rate: <input id="nn-dropout" type="number" step="0.05" value="0" min="0" max="0.9"></label>
              <label>Activation:
                <select id="nn-activation">
                  <option value="relu">ReLU</option>
                  <option value="tanh">Tanh</option>
                  <option value="sigmoid">Sigmoid</option>
                </select>
              </label>

              <div class="iteration-info">
                <strong>Epoch: </strong><span id="nn-epoch">0</span> •
                <strong>Params: </strong><span id="nn-params">0</span>
              </div>

              <div id="nn-steps" style="display:none">
                <h4>Training Process</h4>
                <div class="step-info">
                  <div class="step-title">Epoch Details</div>
                  <div id="nn-step-display" class="calculations" style="max-height:300px;overflow-y:auto;"></div>
                </div>
              </div>

              <div id="nn-metrics" style="display:none">
                <h4>Model Metrics</h4>
                <div class="values-grid" id="nn-reg-metrics">
                  <div class="value-box"><strong>MSE</strong><div id="nn-mse">—</div></div>
                  <div class="value-box"><strong>R²</strong><div id="nn-r2">—</div></div>
                  <div class="value-box"><strong>MAE</strong><div id="nn-mae">—</div></div>
                </div>
                <div class="values-grid" id="nn-cls-metrics" style="display:none">
                  <div class="value-box"><strong>Accuracy</strong><div id="nn-accuracy">—</div></div>
                  <div class="value-box"><strong>Precision</strong><div id="nn-precision">—</div></div>
                  <div class="value-box"><strong>Recall</strong><div id="nn-recall">—</div></div>
                  <div class="value-box"><strong>F1 Score</strong><div id="nn-f1">—</div></div>
                  <div class="value-box"><strong>Log Loss</strong><div id="nn-logloss">—</div></div>
                </div>
              </div>

              <div class="calculations" style="background:#e0f2fe;padding:8px;border-radius:4px;margin-top:12px;">
                <p style="margin:4px 0;font-size:12px;"><strong>Neural Network:</strong> Multi-layer perceptron with configurable architecture. Uses gradient descent with backpropagation to minimize loss. <strong>Forward:</strong> z = Wx + b, a = σ(z). <strong>Backward:</strong> ∂L/∂W via chain rule.</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Statistics Tab -->
  <div class="tab-content" id="tab-stats">
    <div class="panel">
      <h3>Statistics Tools</h3>
      <div class="tabs" style="margin-bottom: 20px;">
        <div class="tab active" data-subtab="correlation">Correlation</div>
        <div class="tab" data-subtab="ttest">t-Test</div>
        <div class="tab" data-subtab="anova">ANOVA</div>
      </div>

      <!-- Correlation -->
      <div class="subtab-content active" id="subtab-correlation">
        <div class="main-grid">
          <div class="panel">
            <canvas id="plot-correlation" width="800" height="500"></canvas>
            <div class="hint">Click to add paired observations (x, y) • Right-click to delete last point</div>
            <div class="controls">
              <button id="calc-correlation" class="primary">Calculate</button>
              <button id="clear-correlation">Clear</button>
              <button id="sample-correlation">Sample Data</button>
            </div>
          </div>
          <div>
            <div class="panel">
              <h4>Pearson Correlation</h4>
              <p><strong>Points: </strong><span id="corr-point-count">0</span></p>
              <div class="calculations" style="background:#e0f2fe;padding:8px;border-radius:4px;margin:8px 0;">
                <p style="margin:4px 0;font-size:12px;"><strong>What is Correlation?</strong> Measures the strength and direction of a linear relationship between two variables. r ranges from -1 (perfect negative) to +1 (perfect positive), with 0 indicating no linear relationship.</p>
              </div>
              <div id="corr-results" style="display:none">
                <h4>Formulas</h4>
                <div class="calculations">
                  <div class="calc-step"><span id="corr-formula-tex"></span></div>
                  <div class="calc-step"><span id="corr-cov-formula-tex"></span></div>
                  <div class="calc-step"><span id="corr-std-formula-tex"></span></div>
                </div>
                <h4>Steps</h4>
                <div class="calculations">
                  <div class="calc-step"><span id="corr-n-tex"></span></div>
                  <div class="calc-step"><span id="corr-mean1-tex"></span></div>
                  <div class="calc-step"><span id="corr-mean2-tex"></span></div>
                  <div class="calc-step"><span id="corr-cov-tex"></span></div>
                  <div class="calc-step"><span id="corr-std1-tex"></span></div>
                  <div class="calc-step"><span id="corr-std2-tex"></span></div>
                </div>
                <h4>Result</h4>
                <div class="values-grid">
                  <div class="value-box"><strong>r</strong><div id="corr-r-val">—</div></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- t-Test -->
      <div class="subtab-content" id="subtab-ttest">
        <div class="main-grid">
          <div class="panel">
            <canvas id="plot-ttest" width="800" height="500"></canvas>
            <div class="hint">Click left (red) or right (blue) region to add points • Right-click to delete last</div>
            <div class="controls">
              <span><strong>Active Group: </strong></span>
              <button id="ttest-group1-btn" class="success">Group 1 (Left)</button>
              <button id="ttest-group2-btn">Group 2 (Right)</button>
              <button id="calc-ttest" class="primary">Calculate</button>
              <button id="clear-ttest">Clear</button>
              <button id="sample-ttest">Sample Data</button>
            </div>
            <div class="controls" style="margin-top:12px;">
              <span><strong>Test Type: </strong></span>
              <label style="display:inline;margin:0 12px 0 0;font-weight:normal;">
                <input type="radio" name="ttest-type" value="two-tailed" checked> Two-tailed
              </label>
              <label style="display:inline;margin:0 12px 0 0;font-weight:normal;">
                <input type="radio" name="ttest-type" value="left"> One-tailed (left)
              </label>
              <label style="display:inline;margin:0 12px 0 0;font-weight:normal;">
                <input type="radio" name="ttest-type" value="right"> One-tailed (right)
              </label>
            </div>
          </div>
          <div>
            <div class="panel">
              <h4>Two-Sample t-Test</h4>
              <p><strong>Group 1 (red): </strong><span id="ttest-n1">0</span> points | <strong>Group 2 (blue): </strong><span id="ttest-n2">0</span> points</p>
              <div class="calculations" style="background:#e0f2fe;padding:8px;border-radius:4px;margin:8px 0;">
                <p style="margin:4px 0;font-size:12px;"><strong>What is t-Test?</strong> A statistical test to compare means of two independent groups. The t-statistic measures how many standard errors the means are apart.</p>
              </div>
              <div id="ttest-results" style="display:none">
                <h4>Formulas</h4>
                <div class="calculations">
                  <div class="calc-step"><span id="ttest-formula-tex"></span></div>
                  <div class="calc-step"><span id="ttest-pooled-formula-tex"></span></div>
                  <div class="calc-step"><span id="ttest-se-formula-tex"></span></div>
                </div>
                <h4>Steps</h4>
                <div class="calculations">
                  <div class="calc-step"><span id="ttest-n-tex"></span></div>
                  <div class="calc-step"><span id="ttest-mean1-tex"></span></div>
                  <div class="calc-step"><span id="ttest-mean2-tex"></span></div>
                  <div class="calc-step"><span id="ttest-var1-tex"></span></div>
                  <div class="calc-step"><span id="ttest-var2-tex"></span></div>
                  <div class="calc-step"><span id="ttest-pooled-tex"></span></div>
                  <div class="calc-step"><span id="ttest-se-tex"></span></div>
                  <div class="calc-step"><span id="ttest-df-tex"></span></div>
                </div>
                <h4>Result</h4>
                <div class="values-grid">
                  <div class="value-box"><strong>t</strong><div id="ttest-t-val">—</div></div>
                  <div class="value-box"><strong>df</strong><div id="ttest-df-val">—</div></div>
                  <div class="value-box"><strong>|t|</strong><div id="ttest-t-abs">—</div></div>
                  <div class="value-box"><strong>p-value</strong><div id="ttest-pval">—</div></div>
                </div>
                <div class="calculations" style="background:#dbeafe;border-color:#3b82f6;margin-top:12px;">
                  <p style="margin:4px 0;font-size:12px;"><strong>Interpretation:</strong> <span id="ttest-pval-text">Calculate to see result</span></p>
                </div>
                <div class="panel" style="margin-top:12px;">
                  <h4>t-Distribution</h4>
                  <canvas id="ttest-dist-plot" width="400" height="300"></canvas>
                  <p style="font-size:11px;color:#64748b;margin-top:8px;">Gray curve: t-distribution. Red line: your t-statistic. Shaded area: p-value (changes based on test type)</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- ANOVA -->
      <div class="subtab-content" id="subtab-anova">
        <div class="main-grid">
          <div class="panel">
            <canvas id="plot-anova" width="800" height="500"></canvas>
            <div class="hint">Click a colored region to add points to that group • Right-click to delete last from active group • Use keys 1-5 to select groups</div>
            <div class="controls">
              <span><strong>Active Group: </strong></span>
              <button id="anova-g1-btn" class="success">G1</button>
              <button id="anova-g2-btn">G2</button>
              <button id="anova-g3-btn">G3</button>
              <button id="anova-g4-btn">G4</button>
              <button id="anova-g5-btn">G5</button>
              <button id="calc-anova" class="primary">Calculate</button>
              <button id="clear-anova">Clear</button>
              <button id="sample-anova">Sample Data</button>
            </div>
          </div>
          <div>
            <div class="panel">
              <h4>One-Way ANOVA</h4>
              <p><strong>Group Counts: </strong>
                <span id="anova-g1">G1: 0</span> |
                <span id="anova-g2">G2: 0</span> |
                <span id="anova-g3">G3: 0</span> |
                <span id="anova-g4">G4: 0</span> |
                <span id="anova-g5">G5: 0</span>
              </p>
              <div class="calculations" style="background:#e0f2fe;padding:8px;border-radius:4px;margin:8px 0;">
                <p style="margin:4px 0;font-size:12px;"><strong>What is ANOVA?</strong> Analysis of Variance tests whether means of multiple groups are significantly different. The F-statistic compares between-group variance to within-group variance.</p>
              </div>
              <div id="anova-results" style="display:none">
                <h4>Formulas</h4>
                <div class="calculations">
                  <div class="calc-step"><span id="anova-formula-tex"></span></div>
                  <div class="calc-step"><span id="anova-ssb-formula-tex"></span></div>
                  <div class="calc-step"><span id="anova-ssw-formula-tex"></span></div>
                  <div class="calc-step"><span id="anova-df-formula-tex"></span></div>
                </div>
                <h4>Steps</h4>
                <div class="calculations">
                  <div class="calc-step"><span id="anova-grand-tex"></span></div>
                  <div class="calc-step"><span id="anova-means-tex"></span></div>
                  <div class="calc-step"><span id="anova-ssb-tex"></span></div>
                  <div class="calc-step"><span id="anova-ssw-tex"></span></div>
                  <div class="calc-step"><span id="anova-dfb-tex"></span></div>
                  <div class="calc-step"><span id="anova-dfw-tex"></span></div>
                  <div class="calc-step"><span id="anova-msb-tex"></span></div>
                  <div class="calc-step"><span id="anova-msw-tex"></span></div>
                </div>
                <h4>Result</h4>
                <div class="values-grid">
                  <div class="value-box"><strong>F</strong><div id="anova-f-val">—</div></div>
                  <div class="value-box"><strong>df</strong><div id="anova-df-val">—</div></div>
                  <div class="value-box"><strong>p-value</strong><div id="anova-pval">—</div></div>
                </div>
                <div class="calculations" style="background:#dbeafe;border-color:#3b82f6;margin-top:12px;">
                  <p style="margin:4px 0;font-size:12px;"><strong>Interpretation:</strong> <span id="anova-pval-text">Calculate to see result</span></p>
                </div>
                <div class="panel" style="margin-top:12px;">
                  <h4>F-Distribution</h4>
                  <canvas id="anova-dist-plot" width="400" height="300"></canvas>
                  <p style="font-size:11px;color:#64748b;margin-top:8px;">Gray curve: F-distribution. Red line: your F-statistic. Shaded area: p-value (right tail)</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Recommendation Systems Tab -->
  <div class="tab-content" id="tab-recsys">
    <div class="panel">
      <h3>Recommendation Systems</h3>

      <!-- Ratings Data Table (shared between both methods) -->
      <div class="panel" style="margin-bottom: 20px;">
        <h4>User-Movie Ratings Matrix</h4>
        <div class="hint">Edit cell values (0-5, where 0 = not rated) • Click "Add Row/Column" to expand the matrix</div>
        <div class="controls">
          <button id="recsys-add-user" class="success">Add User</button>
          <button id="recsys-add-movie" class="success">Add Movie</button>
          <button id="recsys-reset-data">Reset to Default</button>
          <button id="recsys-random-data">Generate Random</button>
        </div>
        <div class="table-container" style="margin-top: 12px;">
          <table id="recsys-ratings-table" class="editable-table">
            <thead id="recsys-ratings-header">
              <tr>
                <th></th>
                <th contenteditable="true" class="movie-name">Movie 1</th>
                <th contenteditable="true" class="movie-name">Movie 2</th>
                <th contenteditable="true" class="movie-name">Movie 3</th>
              </tr>
            </thead>
            <tbody id="recsys-ratings-body">
              <tr>
                <th contenteditable="true" class="user-name">User 1</th>
                <td contenteditable="true" class="rating-cell">5</td>
                <td contenteditable="true" class="rating-cell">3</td>
                <td contenteditable="true" class="rating-cell">0</td>
              </tr>
              <tr>
                <th contenteditable="true" class="user-name">User 2</th>
                <td contenteditable="true" class="rating-cell">4</td>
                <td contenteditable="true" class="rating-cell">0</td>
                <td contenteditable="true" class="rating-cell">0</td>
              </tr>
              <tr>
                <th contenteditable="true" class="user-name">User 3</th>
                <td contenteditable="true" class="rating-cell">1</td>
                <td contenteditable="true" class="rating-cell">1</td>
                <td contenteditable="true" class="rating-cell">0</td>
              </tr>
              <tr>
                <th contenteditable="true" class="user-name">User 4</th>
                <td contenteditable="true" class="rating-cell">1</td>
                <td contenteditable="true" class="rating-cell">0</td>
                <td contenteditable="true" class="rating-cell">5</td>
              </tr>
              <tr>
                <th contenteditable="true" class="user-name">User 5</th>
                <td contenteditable="true" class="rating-cell">0</td>
                <td contenteditable="true" class="rating-cell">1</td>
                <td contenteditable="true" class="rating-cell">5</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Movie Features Table (for Content-Based Filtering) -->
      <div class="panel" style="margin-bottom: 20px;">
        <h4>Movie Features Matrix (Content)</h4>
        <div class="hint">Edit feature values (0 or 1 for binary features, or weighted values 0-1) • Features represent genres/attributes</div>
        <div class="controls">
          <button id="features-add-genre" class="success">Add Genre/Feature</button>
          <button id="features-reset-data">Reset to Default</button>
          <button id="features-random-data">Generate Random</button>
        </div>
        <div class="table-container" style="margin-top: 12px;">
          <table id="movie-features-table" class="editable-table">
            <thead id="movie-features-header">
              <tr>
                <th></th>
                <th contenteditable="true" class="genre-name">Action</th>
                <th contenteditable="true" class="genre-name">Romance</th>
                <th contenteditable="true" class="genre-name">Comedy</th>
                <th contenteditable="true" class="genre-name">Drama</th>
                <th contenteditable="true" class="genre-name">Sci-Fi</th>
              </tr>
            </thead>
            <tbody id="movie-features-body">
              <tr data-movie-idx="0">
                <th class="movie-label">Movie 1</th>
                <td contenteditable="true" class="feature-cell">1</td>
                <td contenteditable="true" class="feature-cell">0</td>
                <td contenteditable="true" class="feature-cell">0</td>
                <td contenteditable="true" class="feature-cell">1</td>
                <td contenteditable="true" class="feature-cell">0</td>
              </tr>
              <tr data-movie-idx="1">
                <th class="movie-label">Movie 2</th>
                <td contenteditable="true" class="feature-cell">0</td>
                <td contenteditable="true" class="feature-cell">1</td>
                <td contenteditable="true" class="feature-cell">1</td>
                <td contenteditable="true" class="feature-cell">0</td>
                <td contenteditable="true" class="feature-cell">0</td>
              </tr>
              <tr data-movie-idx="2">
                <th class="movie-label">Movie 3</th>
                <td contenteditable="true" class="feature-cell">1</td>
                <td contenteditable="true" class="feature-cell">0</td>
                <td contenteditable="true" class="feature-cell">0</td>
                <td contenteditable="true" class="feature-cell">0</td>
                <td contenteditable="true" class="feature-cell">1</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Content-Based Filtering -->
      <div class="panel">
        <h4>Content-Based Filtering</h4>
        <div class="calculations" style="background:#e0f2fe;padding:8px;border-radius:4px;margin:8px 0;">
          <p style="margin:4px 0;font-size:12px;"><strong>What is Content-Based Filtering?</strong> Recommends items similar to those a user has liked in the past, based on <strong>explicit content features</strong> (e.g., genres, directors, actors). We build a user profile from features of movies they've rated highly.</p>
        </div>

        <label>Similarity Measure:
          <select id="cb-similarity-select">
            <option value="cosine">Cosine Similarity</option>
            <option value="euclidean">Euclidean Distance</option>
          </select>
        </label>

        <div class="controls">
          <button id="compute-cb" class="primary">Compute Recommendations for All Users</button>
        </div>

        <div id="cb-equations" style="display:none; margin-top: 16px;">
          <h4>Algorithm Steps</h4>
          <div class="calculations">
            <div class="calc-step"><strong>Step 1: Extract Item Features</strong></div>
            <div class="calc-step"><span id="cb-eq-features"></span></div>

            <div class="calc-step" style="margin-top: 12px;"><strong>Step 2: Build User Profile</strong></div>
            <div class="calc-step"><span id="cb-eq-profile"></span></div>

            <div class="calc-step" style="margin-top: 12px;"><strong>Step 3: Compute Similarity</strong></div>
            <div class="calc-step"><span id="cb-eq-similarity"></span></div>
          </div>
        </div>

        <div id="cb-results" style="display:none">
          <h4>Step 1: Ratings Matrix & Movie Content Features</h4>
          <div class="calculations">
            <div class="calc-step"><span id="cb-step1-tex"></span></div>
          </div>

          <h4>Step 2: Build User Profiles from Rated Movies' Features</h4>
          <div class="calculations">
            <div class="calc-step"><span id="cb-step2-tex"></span></div>
          </div>

          <h4>Step 3: Compute Similarity Between User Profiles and Movie Features</h4>
          <div class="calculations">
            <div class="calc-step"><span id="cb-step3-tex"></span></div>
          </div>

          <h4>Step 4: Convert Similarity to Predicted Ratings</h4>
          <div class="calculations">
            <div class="calc-step"><span id="cb-step4-tex"></span></div>
          </div>

          <h4>Step 5: Predicted Ratings for All Users</h4>
          <div class="calculations">
            <div class="calc-step" style="font-size:12px;color:#666;margin-bottom:8px;">
              <strong>Blue background</strong> = Actual ratings already given by user<br>
              <strong>Green text</strong> = Predicted ratings based on content similarity (hover to see similarity score)
            </div>
          </div>
          <div class="table-container">
            <table id="cb-predictions-table"></table>
          </div>
        </div>
      </div>

      <!-- Collaborative Filtering -->
      <div class="panel">
        <h4>Collaborative Filtering (Matrix Factorization)</h4>
        <div class="calculations" style="background:#e0f2fe;padding:8px;border-radius:4px;margin:8px 0;">
          <p style="margin:4px 0;font-size:12px;"><strong>What is Collaborative Filtering?</strong> Uses patterns from multiple users' behavior to make predictions. Matrix Factorization decomposes the user-item rating matrix R ≈ P × Q<sup>T</sup>, where P is user features and Q is item features.</p>
        </div>

        <div class="controls">
          <button id="init-cf" class="warning">Initialize</button>
          <button id="next-epoch-cf" class="success" disabled>Next Epoch</button>
          <button id="auto-cf">Auto</button>
          <button id="reset-cf">Reset</button>
        </div>

        <label>Latent Factors (k): <input id="cf-k" type="number" min="1" max="10" value="2"></label>
        <label>Learning Rate (η): <input id="cf-lr" type="number" step="0.001" value="0.01" min="0.0001" max="1"></label>
        <label>Regularization (λ): <input id="cf-lambda" type="number" step="0.001" value="0.01" min="0" max="1"></label>
        <label>Max Epochs (Auto): <input id="cf-max-epochs" type="number" min="1" max="1000" value="100"></label>

        <div class="iteration-info">
          <strong>Epoch: </strong><span id="cf-epoch">0</span> •
          <strong>Loss: </strong><span id="cf-loss">—</span>
        </div>

        <div id="cf-equations" style="display:none; margin-top: 16px;">
          <h4>Algorithm Steps</h4>
          <div class="calculations">
            <div class="calc-step"><strong>Step 1: Initialize Matrices</strong></div>
            <div class="calc-step"><span id="cf-eq-init"></span></div>

            <div class="calc-step" style="margin-top: 12px;"><strong>Step 2: Predict Rating</strong></div>
            <div class="calc-step"><span id="cf-eq-predict"></span></div>

            <div class="calc-step" style="margin-top: 12px;"><strong>Step 3: Compute Error</strong></div>
            <div class="calc-step"><span id="cf-eq-error"></span></div>

            <div class="calc-step" style="margin-top: 12px;"><strong>Step 4: Update Parameters (Gradient Descent)</strong></div>
            <div class="calc-step"><span id="cf-eq-update"></span></div>

            <div class="calc-step" style="margin-top: 12px;"><strong>Step 5: Compute Loss</strong></div>
            <div class="calc-step"><span id="cf-eq-loss"></span></div>
          </div>
        </div>

        <div class="panel" style="margin-top: 16px;">
          <div class="gd-grid">
            <div>
              <div class="subtle">Loss History</div>
              <canvas id="cf-loss-plot" width="400" height="300"></canvas>
            </div>
            <div>
              <div class="subtle">Predicted Ratings Heatmap</div>
              <canvas id="cf-heatmap" width="380" height="300"></canvas>
            </div>
          </div>
        </div>

        <div id="cf-matrices" style="display:none">
          <h4>Learned Factor Matrices</h4>
          <div class="table-container" style="margin-bottom: 12px;">
            <strong>User Features (P)</strong>
            <table id="cf-p-matrix" style="margin-top: 8px;"></table>
          </div>
          <div class="table-container">
            <strong>Item Features (Q)</strong>
            <table id="cf-q-matrix" style="margin-top: 8px;"></table>
          </div>
        </div>

        <div id="cf-predictions" style="display:none">
          <h4>Predicted Ratings</h4>
          <div class="table-container">
            <table id="cf-pred-table"></table>
          </div>
        </div>

        <div id="cf-metrics" style="display:none">
          <h4>Model Metrics</h4>
          <div class="values-grid">
            <div class="value-box"><strong>RMSE</strong><div id="cf-rmse">—</div></div>
            <div class="value-box"><strong>MAE</strong><div id="cf-mae">—</div></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Clustering Tab -->
  <div class="tab-content" id="tab-clustering">
    <div class="panel">
      <h3>Clustering Analysis</h3>

      <!-- Main grid: Canvas on left, K-Means controls on right -->
      <div class="main-grid">
        <div class="panel">
          <canvas id="plot-clustering" width="800" height="500"></canvas>
          <div class="hint">Click to add points • Right-click to delete last point</div>
          <div class="controls">
            <button id="clustering-clear">Clear</button>
            <button id="clustering-sample">Sample Data</button>
            <span><strong>Points: </strong><span id="clustering-point-count">0</span></span>
          </div>
        </div>

        <div>
          <!-- K-Means Clustering Controls -->
          <div class="panel">
            <h4>K-Means Clustering</h4>
            <div class="calculations" style="background:#e0f2fe;padding:8px;border-radius:4px;margin:8px 0;">
              <p style="margin:4px 0;font-size:12px;"><strong>What is K-Means?</strong> Partitions data into K clusters by iteratively assigning points to nearest centroid and updating centroids.</p>
            </div>

            <label>Number of Clusters (K): <input id="kmeans-k" type="number" min="2" max="10" value="3" style="width:60px;"></label>

            <div class="controls">
              <button id="init-kmeans" class="warning">Initialize</button>
              <button id="next-kmeans" class="success" disabled>Next Iteration</button>
              <button id="auto-kmeans">Auto</button>
              <button id="reset-kmeans">Reset</button>
            </div>

            <div class="iteration-info">
              <strong>Iteration: </strong><span id="kmeans-iter">0</span> •
              <strong>Inertia: </strong><span id="kmeans-inertia">—</span>
            </div>

            <!-- Algorithm Steps -->
            <div id="kmeans-equations" style="display:none; margin-top: 16px;">
              <h4>Algorithm Steps</h4>
              <div class="calculations">
                <div class="calc-step"><strong>Step 1: Initialize K Centroids</strong></div>
                <div class="calc-step"><span id="kmeans-eq-init"></span></div>

                <div class="calc-step" style="margin-top: 12px;"><strong>Step 2: Assign Points to Nearest Centroid</strong></div>
                <div class="calc-step"><span id="kmeans-eq-assign"></span></div>

                <div class="calc-step" style="margin-top: 12px;"><strong>Step 3: Update Centroids</strong></div>
                <div class="calc-step"><span id="kmeans-eq-update"></span></div>

                <div class="calc-step" style="margin-top: 12px;"><strong>Step 4: Compute Inertia (Loss)</strong></div>
                <div class="calc-step"><span id="kmeans-eq-loss"></span></div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- K-Means Results (below the grid) -->
      <div id="kmeans-results" style="display:none; margin-top: 20px;">
        <div class="panel">
          <h4>Current Iteration Details</h4>
          <div class="calculations">
            <div class="calc-step"><span id="kmeans-step-display"></span></div>
          </div>

          <h4>Cluster Assignments</h4>
          <div class="table-container">
            <table id="kmeans-assignments-table"></table>
          </div>

          <h4>Cluster Centroids</h4>
          <div class="table-container">
            <table id="kmeans-centers-table"></table>
          </div>

          <h4>Metrics</h4>
          <div class="values-grid">
            <div class="value-box"><strong>Inertia</strong><div id="kmeans-inertia-val">—</div></div>
            <div class="value-box"><strong>Silhouette</strong><div id="kmeans-silhouette">—</div></div>
            <div class="value-box"><strong>Points</strong><div id="kmeans-n-points">—</div></div>
          </div>
        </div>
      </div>

      <!-- Hierarchical Clustering -->
      <div class="panel">
        <h4>Hierarchical Clustering (Agglomerative)</h4>
        <div class="calculations" style="background:#e0f2fe;padding:8px;border-radius:4px;margin:8px 0;">
          <p style="margin:4px 0;font-size:12px;"><strong>What is Hierarchical Clustering?</strong> A bottom-up clustering approach that starts with each point as its own cluster, then repeatedly merges the two closest clusters until only one remains. The result is a dendrogram showing the hierarchy of clusters.</p>
        </div>

        <label>Linkage Method:
          <select id="hierarchical-linkage">
            <option value="single">Single (Min Distance)</option>
            <option value="complete">Complete (Max Distance)</option>
            <option value="average" selected>Average (Mean Distance)</option>
          </select>
        </label>

        <label>Number of Clusters: <input id="hierarchical-n-clusters" type="number" min="1" max="10" value="3" style="width:60px;"></label>

        <div class="controls">
          <button id="compute-hierarchical" class="primary">Compute Clustering</button>
          <button id="reset-hierarchical">Reset</button>
        </div>

        <!-- Algorithm Steps -->
        <div id="hierarchical-equations" style="display:none; margin-top: 16px;">
          <h4>Algorithm Steps</h4>
          <div class="calculations">
            <div class="calc-step"><strong>Step 1: Initialize Distance Matrix</strong></div>
            <div class="calc-step"><span id="hierarchical-eq-init"></span></div>

            <div class="calc-step" style="margin-top: 12px;"><strong>Step 2: Find Closest Clusters</strong></div>
            <div class="calc-step"><span id="hierarchical-eq-find"></span></div>

            <div class="calc-step" style="margin-top: 12px;"><strong>Step 3: Merge Clusters</strong></div>
            <div class="calc-step"><span id="hierarchical-eq-merge"></span></div>

            <div class="calc-step" style="margin-top: 12px;"><strong>Step 4: Update Distance Matrix</strong></div>
            <div class="calc-step"><span id="hierarchical-eq-update"></span></div>
          </div>
        </div>

        <!-- Results -->
        <div id="hierarchical-results" style="display:none">
          <h4>Merge History</h4>
          <div class="calculations">
            <div class="calc-step"><span id="hierarchical-merge-history"></span></div>
          </div>

          <h4>Final Cluster Assignments</h4>
          <div class="table-container">
            <table id="hierarchical-assignments-table"></table>
          </div>

          <h4>Dendrogram</h4>
          <div class="panel" style="background:#f8fafc;padding:12px;">
            <canvas id="hierarchical-dendrogram" width="600" height="300"></canvas>
          </div>

          <h4>Metrics</h4>
          <div class="values-grid">
            <div class="value-box"><strong>Clusters</strong><div id="hierarchical-n-clusters-val">—</div></div>
            <div class="value-box"><strong>Points</strong><div id="hierarchical-n-points">—</div></div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Load modules in order: utilities first, then solvers, then main app -->
<script src="{{ url_for('static', filename='utils.js') }}"></script>
<script src="{{ url_for('static', filename='solvers.js') }}"></script>
<script src="{{ url_for('static', filename='app.js') }}"></script>
</body>
</html>
